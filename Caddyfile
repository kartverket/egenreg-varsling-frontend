:{$PORT}

@backendUrls {
    path /api/*
}

route @backendUrls {
    reverse_proxy meldingstjeneste:8080 {
        header_up Host {upstream_hostport}
    }
}

log {
    output stdout
    format console
}

encode gzip

route {
    try_files {path} /index.html
}

header * {
    Strict-Transport-Security: max-age=31536000
    X-Content-Type-Options nosniff
    X-XSS-Protection "1"
    Referrer-Policy "strict-origin"
    Content-Security-Policy "default-src 'none'; style-src 'self' 'unsafe-inline' script-src 'self' blob: https://cdn.jsdelivr.net/; font-src 'self' https://fonts.gstatic.com; media-src 'self'; img-src 'self'; data:; form-action 'self'; connect-src 'self' https://faro.atgcp1-prod.kartverket.cloud; base-uri 'none'; worker-src 'self' blob:; frame-ancestors 'self';"
    Permissions-Policy "geolocation=(),midi=(),microphone=(),camera=(),magnetometer=(),gyroscope=(),payment=()"
}

@fonts {
    path_regexp fonts \.(woff2?|eot|ttf|otf)$
}

header @fonts Cache-Control "public, max-age=31536000, immutable"

file_server